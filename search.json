[{"title":"obj","url":"/2019/04/01/obj/","content":"\n## 弱符号与强符号\n* 编译器默认函数和初始化了的全局变量为强符号，未初始化的全局变量为弱符号\n>规则一：不允许强符号多次定义；如果有多个强符号，则链接器报符号重复定义错误。  \n>规则二：如果一个符号在某个目标文件中是强符号，在其他文件中都是弱符号，那么选择强符号。  \n>规则三：如果一个符号在所有目标文件中都是弱符号，那么选择其中占用空间最大的一个。  \n* 尽量不要使用多个不用类型的弱符号，否则容易导致很难发现的程序错误。  \n## 弱引用和强引用\n* 强引用：链接器找不到该符号的定义，就用报符号未定义错误。\n* 弱引用：如果引用符号未被定义，链接器不报错。链接器默认未定义的弱引用为0或者一个特殊值，以便程序代码能够识别。  \n```\n//gcc不会报链接错误，但是会发生运行错误。因为foo函数的地址为0,会发生非法访问。\n__attribute__ ((weakref)) void foo();\nint main()\n{\n    foo();\n    return 0;\n}\n```\n```\n//一个改进的例子。当foo没定义时不执行foo\n__attribute__ ((weakref)) void foo();\nint main()\n{\n    if(foo)\n        foo();\n    return 0;\n}\n```\n* 弱符号和弱引用对于库来说十分有用。  \n>如果一个程序被设计成可以支持单线程或者多线程的模式，就可以通过弱引用判断当前的程序是链接到了单线程Glibc库还是多线程的Glibc库。\n```\n#include <stdio.h>\n#include <pthread.h>\nint pthread_create(\n    pthread_t*,\n    const pthread_attr_t*,\n    void* (*)(void*),\n    void*) __attribute__ ((weak));\n\nint main()\n{\n    if(pthread_create)\n        printf(\"This is multi-thread version!\\n\");\n    else    //当链接单线程的Glibc库时，pthread_create未定义，函数地址为0\n        printf(\"This is single-thread version!\\n\");\n    return 0;\n}\n```","tags":["链接"]},{"title":"Hello World","url":"/2019/03/31/hello-world/","content":"Welcome to [Hexo](https://hexo.io/)! This is your very first post. Check [documentation](https://hexo.io/docs/) for more info. If you get any problems when using Hexo, you can find the answer in [troubleshooting](https://hexo.io/docs/troubleshooting.html) or you can ask me on [GitHub](https://github.com/hexojs/hexo/issues).\n\n## Quick Start\n\n### Create a new post\n\n``` bash\n$ hexo new \"My New Post\"\n```\n\nMore info: [Writing](https://hexo.io/docs/writing.html)\n\n### Run server\n\n``` bash\n$ hexo server\n```\n\nMore info: [Server](https://hexo.io/docs/server.html)\n\n### Generate static files\n\n``` bash\n$ hexo generate\n```\n\nMore info: [Generating](https://hexo.io/docs/generating.html)\n\n### Deploy to remote sites\n\n``` bash\n$ hexo deploy\n```\n\nMore info: [Deployment](https://hexo.io/docs/deployment.html)\n"}]